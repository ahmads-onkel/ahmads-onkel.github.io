<script>
let min = 1;
let max = 100;
let current = random();
let balance = 1000;
let bet = 100;
let streak = 0;

const MIN_RANGE_SIZE = 10;
const HOUSE_EDGE = 0.95; // 5% house edge

updateUI();

function random(){
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function updateUI(){
    document.getElementById("number").innerText = current;
    document.getElementById("balance").innerText = "Kontostand: " + balance + "€";
    document.getElementById("rangeDisplay").innerText = "Range: " + min + " - " + max;
    document.getElementById("streak").innerText = "Streak: " + streak;

    let total = (max - min);
    let pHigher = current >= max ? 0 : (max - current) / total;
    let pLower  = current <= min ? 0 : (current - min) / total;

    document.getElementById("riskDisplay").innerText =
        "Higher: " + (pHigher * 100).toFixed(1) + "% | Lower: " + (pLower * 100).toFixed(1) + "%";
}

function guess(type){

    if(balance < bet){
        alert("Nicht genug Guthaben!");
        return;
    }

    let next = random();
    let win = false;

    let total = (max - min);
    let p;

    if(type === "higher"){
        p = current >= max ? 0 : (max - current) / total;
        if(next > current) win = true;
    } else {
        p = current <= min ? 0 : (current - min) / total;
        if(next < current) win = true;
    }

    // Gleichstand = Loss
    if(next === current) win = false;

    if(win && p > 0){

        let multiplier = (1 / p) * HOUSE_EDGE;

        // multiplier cap
        if(multiplier > 10) multiplier = 10;

        let gain = Math.floor(bet * multiplier);

        // streak bonus
        if(streak >= 3){
            gain += 20;
        }

        balance += gain;
        document.getElementById("profit").innerText = "+" + gain + "€";
        streak++;

        // Range shrink nur wenn noch groß genug
        if(streak % 3 === 0 && (max - min) > MIN_RANGE_SIZE){
            min += 2;
            max -= 2;
        }

        current = next;

    } else {

        balance -= bet;
        document.getElementById("profit").innerText = "-" + bet + "€";
        streak = 0;
        resetRange();
        current = random();
    }

    if(balance <= 0){
        alert("Game Over");
        balance = 1000;
        streak = 0;
        resetRange();
        current = random();
    }

    updateUI();
}

function cashout(){

    if(streak > 0){
        let bonus = streak * 10;
        balance += bonus;
        document.getElementById("profit").innerText = "Cashout Bonus +" + bonus + "€";
    }

    streak = 0;
    resetRange();
    current = random();
    updateUI();
}

function resetRange(){
    min = 1;
    max = 100;
}
</script>
