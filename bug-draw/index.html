<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bug Draw</title>

<style>
body{
    margin:0;
    background:white;
    font-family:sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
}

input{
    margin:40px;
    padding:15px;
    width:300px;
    font-size:18px;
    border:3px solid black;
    outline:none;
}

canvas{
    border:2px solid black;
}
</style>
</head>
<body>

<input id="word" placeholder="type something (cat, dog, tree...)">
<canvas id="canvas" width="600" height="500"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const input = document.getElementById("word");

let drawing = [];
let strokeIndex = 0;
let pointIndex = 0;
let scale = 1.8;

input.addEventListener("keydown", function(e){
    if(e.key === "Enter"){
        loadDrawing(input.value.toLowerCase());
    }
});

async function loadDrawing(word){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    try{
        const res = await fetch(
            "https://storage.googleapis.com/quickdraw_dataset/full/simplified/" 
            + word + ".ndjson"
        );

        if(!res.ok) throw new Error("not found");

        const text = await res.text();
        const lines = text.trim().split("\n");

        // zufällige Zeichnung auswählen
        const randomLine = lines[Math.floor(Math.random()*lines.length)];
        const data = JSON.parse(randomLine);

        drawing = data.drawing;
        strokeIndex = 0;
        pointIndex = 0;

        animate();

    }catch{
        alert("Word not found. Try simple English words like: cat, dog, tree, house, bicycle.");
    }
}

function animate(){

    if(strokeIndex >= drawing.length) return;

    const stroke = drawing[strokeIndex];
    const xs = stroke[0];
    const ys = stroke[1];

    if(pointIndex >= xs.length-1){
        strokeIndex++;
        pointIndex = 0;
        requestAnimationFrame(animate);
        return;
    }

    let x1 = xs[pointIndex] * scale + 50;
    let y1 = ys[pointIndex] * scale + 50;
    let x2 = xs[pointIndex+1] * scale + 50;
    let y2 = ys[pointIndex+1] * scale + 50;

    // Linie zeichnen
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();

    // Käfer zeichnen
    drawBug(x2, y2);

    pointIndex++;
    requestAnimationFrame(animate);
}

function drawBug(x, y){
    ctx.beginPath();
    ctx.fillStyle = "black";
    ctx.arc(x, y, 4, 0, Math.PI*2);
    ctx.fill();
}
</script>

</body>
</html>
